<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scaling with competing consumers :: ActiveMQ Artemis Clustering for High-Performance Messaging</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">ActiveMQ Artemis Clustering for High-Performance Messaging</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">ActiveMQ Artemis Clustering for High-Performance Messaging</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction-to-activemq-artemis/introduction-to-activemq-artemis.html">Introduction to ActiveMQ Artemis</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/understanding-message-oriented-middleware-mom.html">Understanding Message-Oriented Middleware (MOM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/core-features-and-benefits-of-activemq-artemis.html">Core features and benefits of ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/decoupling-producers-and-consumers.html">Decoupling Producers and Consumers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/asynchronous-communication-patterns.html">Asynchronous communication patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/traffic-smoothing-and-competing-consumers.html">Traffic smoothing and competing consumers</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../client-side-challenges/client-side-challenges.html">Client-Side Challenges</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/bottlenecks-from-single-connection-to-a-single-broker.html">Bottlenecks from single connection to a single broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/impact-of-default-client-load-balancing-policies.html">Impact of default client load-balancing policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/reduced-cluster-throughput-due-to-message-redistribution.html">Reduced cluster throughput due to message redistribution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/risk-of-high-volume-queues-paging-messages-to-disk.html">Risk of high-volume queues paging messages to disk</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploying-amq-on-openshift/deploying-amq-on-openshift.html">Deploying AMQ on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/overview-of-red-hat-amq-operator.html">Overview of Red Hat AMQ Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/installing-the-amq-operator-on-openshift.html">Installing the AMQ Operator on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/creating-an-activemqartemis-custom-resource-cr.html">Creating an ActiveMQArtemis Custom Resource (CR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/configuring-a-two-node-activemq-artemis-cluster.html">Configuring a two-node ActiveMQ Artemis cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/exposing-broker-services-for-client-connections.html">Exposing broker services for client connections</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../solutions-for-even-message-distribution/solutions-for-even-message-distribution.html">Solutions for Even Message Distribution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/strategies-for-client-side-load-balancing.html">Strategies for client-side load balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/configuring-client-connection-factories-for-multiple-brokers.html">Configuring client connection factories for multiple brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/techniques-to-distribute-messages-evenly-across-cluster-members.html">Techniques to distribute messages evenly across cluster members</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/optimizing-client-connectivity-for-high-throughput.html">Optimizing client connectivity for high throughput</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster/hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster.html">Hands-on Lab: Deploying and Interacting with an ActiveMQ Artemis Cluster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster/setting-up-the-openshift-environment-for-amq-deployment.html">Setting up the OpenShift environment for AMQ deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster/deploying-a-two-node-activemq-artemis-cluster-using-the-operator.html">Deploying a two-node ActiveMQ Artemis cluster using the Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster/developing-and-deploying-client-applications.html">Developing and deploying client applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster/observing-message-distribution-and-cluster-behavior.html">Observing message distribution and cluster behavior</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster/testing-failover-scenarios-and-ha-capabilities.html">Testing failover scenarios and HA capabilities</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ActiveMQ Artemis Clustering for High-Performance Messaging</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">ActiveMQ Artemis Clustering for High-Performance Messaging</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">ActiveMQ Artemis Clustering for High-Performance Messaging</a></li>
    <li><a href="scaling-with-competing-consumers.html">Scaling with competing consumers</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Scaling with competing consumers</h1>
<h1 id="_scaling_with_competing_consumers" class="sect0"><a class="anchor" href="#_scaling_with_competing_consumers"></a>Scaling with Competing Consumers</h1>
<div class="paragraph">
<p>When designing robust and performant message-oriented architectures, especially with increasing message volumes, it&#8217;s critical to ensure that your message processing layer can scale effectively. One of the most fundamental and powerful patterns for achieving this with ActiveMQ Artemis is <strong>scaling with competing consumers</strong>. This strategy allows for efficient message processing by distributing workload across multiple consumer instances.</p>
</div>
<div class="sect1">
<h2 id="_understanding_competing_consumers"><a class="anchor" href="#_understanding_competing_consumers"></a>Understanding Competing Consumers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In essence, competing consumers are multiple independent consumer instances that all subscribe to the <strong>same queue</strong> on an ActiveMQ Artemis broker (or cluster). The core idea is that each message sent to that queue will be processed by exactly one of the available consumers.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a detailed breakdown of how this pattern works and its benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Shared Workload Distribution:</strong> When several consumers are attached to the same queue, ActiveMQ Artemis intelligently distributes the incoming messages among them. Each message is delivered to only one consumer, ensuring that no message is processed multiple times. This transforms a single point of consumption into a shared, load-balanced pool of workers.</p>
</li>
<li>
<p><strong>Automatic Load Balancing:</strong> ActiveMQ Artemis automatically handles the distribution of messages. It does not require explicit configuration to balance messages between consumers on the same queue. If a new consumer instance comes online, Artemis will immediately begin routing messages to it, and if a consumer goes offline, messages will be rerouted to the remaining active consumers. This dynamic adaptation ensures optimal resource utilization and avoids bottlenecks.</p>
</li>
<li>
<p><strong>Horizontal Scalability:</strong> The primary advantage of competing consumers is the ability to scale your message processing capacity horizontally. As your application&#8217;s message load increases, you can simply deploy more instances of your consumer application. Each new instance joins the pool, increasing the total throughput linearly without any changes to the producer&#8217;s code or the queue configuration. This makes your system highly adaptable to varying loads.</p>
</li>
<li>
<p><strong>Increased Throughput:</strong> By allowing multiple consumers to process messages concurrently, the overall rate at which messages are consumed from the queue significantly increases. This is crucial for high-volume systems where a single consumer would quickly become overwhelmed, leading to message backlogs.</p>
</li>
<li>
<p><strong>Resilience and High Availability (HA):</strong> This pattern also enhances the resilience of your system. If one consumer instance crashes or becomes unresponsive, ActiveMQ Artemis will detect its failure (e.g., if messages are not acknowledged) and re-deliver any unacknowledged messages to other available competing consumers. This prevents message loss and ensures continuous processing, contributing to the overall high availability of your messaging system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The concept is to treat the consumers as a processing farm. When a producer sends a message, it doesn&#8217;t care which specific consumer picks it up, only that <strong>a</strong> consumer does.</p>
</div>
<div class="paragraph">
<p>The provided context highlights this with queue statistics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">&gt;&gt;&gt; Queue stats on node e779f217-d741-11f0-906c-0a580ad9003a,
url=tcp://broker-ss-1.broker-hdls-svc.broker.svc.cluster.local:61616
|NAME  |ADDRESS|CONSUMER|MESSAGE|MESSAGES|DELIVERING|MESSAGES|SCHEDULED|ROUTING|INTERNAL|
|      |       | COUNT  | COUNT | ADDED  |  COUNT   | ACKED  |  COUNT  | TYPE  |        |
|prices|prices |   2    |   0   |  188   |    0     |  188   |    0    |ANYCAST| false  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this snippet, for the <code>prices</code> queue, the <code>CONSUMER COUNT</code> is <code>2</code>. This clearly shows two consumers actively listening to the <code>prices</code> queue, demonstrating the competing consumer pattern in a live environment, where they would be sharing the 188 messages that have been added.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_demonstrating_competing_consumers"><a class="anchor" href="#_hands_on_activity_demonstrating_competing_consumers"></a>Hands-on Activity: Demonstrating Competing Consumers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this activity, you will deploy an ActiveMQ Artemis broker, create a simple Java producer application to send messages, and then run multiple instances of a consumer application to observe how ActiveMQ Artemis automatically distributes messages among them.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>An ActiveMQ Artemis broker instance running. For this demonstration, a single standalone broker is sufficient.</p>
</li>
<li>
<p>You can download and run Artemis from its official website.</p>
</li>
<li>
<p>Alternatively, use Docker:
[source,bash]
----
docker run -it --rm -p 8161:8161 -p 61616:61616 apache/activemq-artemis
----</p>
</li>
<li>
<p>Java Development Kit (JDK) 11 or newer installed.</p>
</li>
<li>
<p>Apache Maven build tool installed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_create_a_maven_project"><a class="anchor" href="#_step_1_create_a_maven_project"></a>Step 1: Create a Maven Project</h3>
<div class="paragraph">
<p>First, create a new Maven project that will house both your producer and consumer applications.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new directory for your project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir artemis-competing-consumers
cd artemis-competing-consumers</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>pom.xml</code> file inside <code>artemis-competing-consumers</code> with the following content. This configuration includes the necessary ActiveMQ Artemis JMS client dependency.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.example.artemis&lt;/groupId&gt;
    &lt;artifactId&gt;competing-consumers&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!-- ActiveMQ Artemis JMS Client --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
            &lt;artifactId&gt;artemis-jms-client&lt;/artifactId&gt;
            &lt;version&gt;2.33.0&lt;/version&gt; &lt;!-- Use a recent, stable version --&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;${maven.compiler.source}&lt;/source&gt;
                    &lt;target&gt;${maven.compiler.target}&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.0.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;${exec.mainClass}&lt;/mainClass&gt;
                    &lt;arguments&gt;
                        &lt;argument&gt;${exec.args}&lt;/argument&gt;
                    &lt;/arguments&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_develop_the_producer_application"><a class="anchor" href="#_step_2_develop_the_producer_application"></a>Step 2: Develop the Producer Application</h3>
<div class="paragraph">
<p>Create a Java class <code>src/main/java/com/example/artemis/ProducerApp.java</code> that sends a series of text messages to a queue named <code>myQueue</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>ProducerApp.java</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.artemis;

import javax.jms.*;
import javax.naming.InitialContext;
import java.util.Hashtable;

public class ProducerApp {

    public static void main(String[] args) throws Exception {
        Connection connection = null;
        InitialContext initialContext = null;
        try {
            // Configure JNDI for connection factory
            Hashtable&lt;String, String&gt; env = new Hashtable&lt;&gt;();
            env.put("java.naming.factory.initial", "org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory");
            env.put("connectionFactory.ConnectionFactory", "tcp://localhost:61616");
            env.put("queue.myQueue", "myQueue"); // Define the queue to send messages to

            initialContext = new InitialContext(env);

            ConnectionFactory connectionFactory = (ConnectionFactory) initialContext.lookup("ConnectionFactory");
            connection = connectionFactory.createConnection();
            Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); // Non-transacted, auto-acknowledge
            Queue queue = (Queue) initialContext.lookup("myQueue");
            MessageProducer producer = session.createProducer(queue);

            connection.start(); // Start the connection

            for (int i = 0; i &lt; 20; i++) { // Send 20 messages for demonstration
                TextMessage message = session.createTextMessage("Message " + (i + 1));
                producer.send(message);
                System.out.println("Producer Sent: " + message.getText());
                Thread.sleep(100); // Small delay to observe messages individually
            }

            System.out.println("Producer finished sending messages.");

        } finally {
            if (connection != null) {
                connection.close();
            }
            if (initialContext != null) {
                initialContext.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_develop_the_consumer_application"><a class="anchor" href="#_step_3_develop_the_consumer_application"></a>Step 3: Develop the Consumer Application</h3>
<div class="paragraph">
<p>Create a Java class <code>src/main/java/com/example/artemis/ConsumerApp.java</code> that listens for messages on the <code>myQueue</code>. This consumer will use a <code>MessageListener</code> to asynchronously process incoming messages, similar to the pattern shown in the context.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>ConsumerApp.java</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.artemis;

import javax.jms.*;
import javax.naming.InitialContext;
import java.util.Hashtable;

public class ConsumerApp {

    private static String consumerId; // To identify each consumer instance

    public static void main(String[] args) throws Exception {
        // Allow consumer ID to be passed as an argument, default to "Consumer-1"
        consumerId = (args.length &gt; 0) ? args[0] : "Consumer-1";
        Connection connection = null;
        InitialContext initialContext = null;
        try {
            // Configure JNDI for connection factory and queue
            Hashtable&lt;String, String&gt; env = new Hashtable&lt;&gt;();
            env.put("java.naming.factory.initial", "org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory");
            env.put("connectionFactory.ConnectionFactory", "tcp://localhost:61616");
            env.put("queue.myQueue", "myQueue"); // Define the queue to listen to

            initialContext = new InitialContext(env);
            ConnectionFactory connectionFactory = (ConnectionFactory) initialContext.lookup("ConnectionFactory");
            connection = connectionFactory.createConnection();
            Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); // Non-transacted, auto-acknowledge
            Queue queue = (Queue) initialContext.lookup("myQueue");

            // Create a consumer and set a message listener
            session.createConsumer(queue).setMessageListener(message -&gt; {
                try {
                    String text = message.getBody(String.class);
                    System.out.println(consumerId + " received: " + text);
                } catch (JMSException e) {
                    System.err.println(consumerId + " Error processing message: " + e.getMessage());
                    throw new RuntimeException(e);
                }
            });

            connection.start(); // Start the connection to begin receiving messages
            System.out.println(consumerId + " is waiting for messages...");

            // Keep the consumer application alive indefinitely to receive messages
            Thread.sleep(Long.MAX_VALUE);

        } catch (Exception ex) {
            System.err.println(consumerId + " caught Exception: " + ex.getMessage());
            ex.printStackTrace();
        } finally {
            if (connection != null) {
                connection.close();
            }
            if (initialContext != null) {
                initialContext.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_compile_the_applications"><a class="anchor" href="#_step_4_compile_the_applications"></a>Step 4: Compile the Applications</h3>
<div class="paragraph">
<p>Navigate to your project root directory (<code>artemis-competing-consumers</code>) and compile both applications using Maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will compile your Java classes and download any necessary dependencies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_run_the_broker_if_not_already_running"><a class="anchor" href="#_step_5_run_the_broker_if_not_already_running"></a>Step 5: Run the Broker (if not already running)</h3>
<div class="paragraph">
<p>Ensure your ActiveMQ Artemis broker is running and accessible on <code>tcp://localhost:61616</code>.</p>
</div>
<div class="paragraph">
<p>If using Docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it --rm -p 8161:8161 -p 61616:61616 apache/activemq-artemis</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep this terminal window open.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_6_run_a_single_consumer"><a class="anchor" href="#_step_6_run_a_single_consumer"></a>Step 6: Run a Single Consumer</h3>
<div class="paragraph">
<p>Open a <strong>new</strong> terminal window. Start the first consumer instance, identifying it as <code>Consumer-A</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn exec:java -Dexec.mainClass="com.example.artemis.ConsumerApp" -Dexec.args="Consumer-A"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to: <code>Consumer-A is waiting for messages&#8230;&#8203;</code> Keep this terminal open.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_7_run_the_producer"><a class="anchor" href="#_step_7_run_the_producer"></a>Step 7: Run the Producer</h3>
<div class="paragraph">
<p>Open <strong>another new</strong> terminal window. Run the producer application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn exec:java -Dexec.mainClass="com.example.artemis.ProducerApp"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The producer will send 20 messages. Observe the <code>Consumer-A</code> terminal; it should receive and print all 20 messages, as it is currently the only consumer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_8_run_a_second_competing_consumer"><a class="anchor" href="#_step_8_run_a_second_competing_consumer"></a>Step 8: Run a Second Competing Consumer</h3>
<div class="paragraph">
<p>Open a <strong>third new</strong> terminal window. Start a second consumer instance, identifying it as <code>Consumer-B</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn exec:java -Dexec.mainClass="com.example.artemis.ConsumerApp" -Dexec.args="Consumer-B"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to: <code>Consumer-B is waiting for messages&#8230;&#8203;</code> Now, both <code>Consumer-A</code> and <code>Consumer-B</code> are actively listening to <code>myQueue</code>. Keep this terminal open.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_9_run_the_producer_again_and_observe_distribution"><a class="anchor" href="#_step_9_run_the_producer_again_and_observe_distribution"></a>Step 9: Run the Producer Again and Observe Distribution</h3>
<div class="paragraph">
<p>Go back to the producer terminal (or open a fourth one if you closed it) and run the producer once more.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn exec:java -Dexec.mainClass="com.example.artemis.ProducerApp"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, observe the output in both the <code>Consumer-A</code> and <code>Consumer-B</code> terminals. You will notice that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Messages are no longer all going to a single consumer.</p>
</li>
<li>
<p>Messages are being <strong>shared</strong> and load-balanced between <code>Consumer-A</code> and <code>Consumer-B</code>. Each consumer will receive roughly half of the 20 messages (e.g., <code>Consumer-A</code> gets 10, <code>Consumer-B</code> gets 10, or a similar distribution).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This clearly demonstrates the competing consumer pattern in action. By adding more consumer instances, you have scaled your message processing capability without any changes to the producer code or the underlying queue configuration. You can try running more consumer instances (e.g., <code>Consumer-C</code>) and observe how messages are further distributed among them, showcasing the linear scalability this pattern provides.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
