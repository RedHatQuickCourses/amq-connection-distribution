<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying a two-node ActiveMQ Artemis cluster using the Operator :: ActiveMQ Artemis Clustering for High-Performance Messaging</title>
    <link rel="prev" href="setting-up-the-openshift-environment-for-amq-deployment.html">
    <link rel="next" href="developing-and-deploying-client-applications.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">ActiveMQ Artemis Clustering for High-Performance Messaging</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">ActiveMQ Artemis Clustering for High-Performance Messaging</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction-to-activemq-artemis/introduction-to-activemq-artemis.html">Introduction to ActiveMQ Artemis</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/understanding-message-oriented-middleware-mom.html">Understanding Message-Oriented Middleware (MOM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/core-features-and-benefits-of-activemq-artemis.html">Core features and benefits of ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/decoupling-producers-and-consumers.html">Decoupling Producers and Consumers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/asynchronous-communication-patterns.html">Asynchronous communication patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-activemq-artemis/traffic-smoothing-and-competing-consumers.html">Traffic smoothing and competing consumers</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../client-side-challenges/client-side-challenges.html">Client-Side Challenges</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/bottlenecks-from-single-connection-to-a-single-broker.html">Bottlenecks from single connection to a single broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/impact-of-default-client-load-balancing-policies.html">Impact of default client load-balancing policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/reduced-cluster-throughput-due-to-message-redistribution.html">Reduced cluster throughput due to message redistribution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../client-side-challenges/risk-of-high-volume-queues-paging-messages-to-disk.html">Risk of high-volume queues paging messages to disk</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploying-amq-on-openshift/deploying-amq-on-openshift.html">Deploying AMQ on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/overview-of-red-hat-amq-operator.html">Overview of Red Hat AMQ Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/installing-the-amq-operator-on-openshift.html">Installing the AMQ Operator on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/creating-an-activemqartemis-custom-resource-cr.html">Creating an ActiveMQArtemis Custom Resource (CR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/configuring-a-two-node-activemq-artemis-cluster.html">Configuring a two-node ActiveMQ Artemis cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-on-openshift/exposing-broker-services-for-client-connections.html">Exposing broker services for client connections</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../solutions-for-even-message-distribution/solutions-for-even-message-distribution.html">Solutions for Even Message Distribution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/strategies-for-client-side-load-balancing.html">Strategies for client-side load balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/configuring-client-connection-factories-for-multiple-brokers.html">Configuring client connection factories for multiple brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/techniques-to-distribute-messages-evenly-across-cluster-members.html">Techniques to distribute messages evenly across cluster members</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions-for-even-message-distribution/optimizing-client-connectivity-for-high-throughput.html">Optimizing client connectivity for high throughput</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster.html">Hands-on Lab: Deploying and Interacting with an ActiveMQ Artemis Cluster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setting-up-the-openshift-environment-for-amq-deployment.html">Setting up the OpenShift environment for AMQ deployment</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="deploying-a-two-node-activemq-artemis-cluster-using-the-operator.html">Deploying a two-node ActiveMQ Artemis cluster using the Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developing-and-deploying-client-applications.html">Developing and deploying client applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="observing-message-distribution-and-cluster-behavior.html">Observing message distribution and cluster behavior</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="testing-failover-scenarios-and-ha-capabilities.html">Testing failover scenarios and HA capabilities</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ActiveMQ Artemis Clustering for High-Performance Messaging</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">ActiveMQ Artemis Clustering for High-Performance Messaging</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">ActiveMQ Artemis Clustering for High-Performance Messaging</a></li>
    <li><a href="hands-on-lab-deploying-and-interacting-with-an-activemq-artemis-cluster.html">Hands-on Lab: Deploying and Interacting with an ActiveMQ Artemis Cluster</a></li>
    <li><a href="deploying-a-two-node-activemq-artemis-cluster-using-the-operator.html">Deploying a two-node ActiveMQ Artemis cluster using the Operator</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Deploying a two-node ActiveMQ Artemis cluster using the Operator</h1>
<h1 id="_deploying_a_two_node_activemq_artemis_cluster_using_the_operator" class="sect0"><a class="anchor" href="#_deploying_a_two_node_activemq_artemis_cluster_using_the_operator"></a>Deploying a two-node ActiveMQ Artemis Cluster using the Operator</h1>
<div class="paragraph">
<p>This section details the process of deploying a robust ActiveMQ Artemis cluster on OpenShift using the Red Hat AMQ Operator. This deployment strategy addresses the client-side challenges of bottlenecks from single connections and the overhead of message redistribution by providing a highly available and scalable messaging infrastructure.</p>
</div>
<div class="sect1">
<h2 id="_red_hat_amq_operator_overview"><a class="anchor" href="#_red_hat_amq_operator_overview"></a>Red Hat AMQ Operator Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In enterprise environments, a single broker represents a single point of failure. ActiveMQ Artemis mitigates this through Clustering, providing Server-Side Load Balancing and High Availability (HA). To effectively manage and scale ActiveMQ Artemis on OpenShift, the Red Hat AMQ Operator is utilized.</p>
</div>
<div class="paragraph">
<p>The Operator simplifies the deployment and lifecycle management of ActiveMQ Artemis instances within an OpenShift cluster. It understands the complexities of ActiveMQ Artemis deployments, allowing users to define their desired broker configuration through a simple Custom Resource (CR) definition. The Operator then takes care of the underlying Kubernetes resources, ensuring the broker instances are correctly provisioned, configured, and maintained. This includes handling aspects like clustering, high availability, and exposing services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_the_amq_operator_on_openshift"><a class="anchor" href="#_deploying_the_amq_operator_on_openshift"></a>Deploying the AMQ Operator on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To deploy a two-node ActiveMQ Artemis cluster on OpenShift, the Red Hat AMQ Operator must first be installed. This Operator will then manage the creation and configuration of the ActiveMQ Artemis brokers based on a Custom Resource (CR).</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Ensure you have access to an OpenShift cluster with <code>oc</code> CLI configured.</p>
</div>
<div class="olist arabic">
<div class="title">Hands-on Activity: Installing the AMQ Operator</div>
<ol class="arabic">
<li>
<p><strong>Access the OpenShift Console</strong>: Log in to your OpenShift cluster web console.</p>
</li>
<li>
<p><strong>Navigate to Operators</strong>: In the left-hand navigation, go to <strong>Operators</strong> &#8594; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p><strong>Search for AMQ Broker</strong>: Use the search bar to find "AMQ Broker" or "Red Hat AMQ Broker".</p>
</li>
<li>
<p><strong>Install the Operator</strong>: Select the "Red Hat AMQ Broker" Operator and click <strong>Install</strong>.</p>
</li>
<li>
<p><strong>Configure Installation</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Choose <code>A specific namespace on the cluster</code> as the installation mode.</p>
</li>
<li>
<p>Select a namespace where you want the Operator to be installed (e.g., <code>amq-operator</code>). If it doesn&#8217;t exist, create it.</p>
</li>
<li>
<p>Click <strong>Install</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Verify Installation</strong>: After installation, navigate to <strong>Operators</strong> &#8594; <strong>Installed Operators</strong> and ensure the "Red Hat AMQ Broker" Operator shows a <code>Succeeded</code> status in your chosen namespace.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively, for command-line deployment, you would typically create an <code>OperatorGroup</code> and <code>Subscription</code> YAML manifest and apply it using <code>oc apply -f &lt;filename.yaml&gt;</code>. However, the OpenShift Console provides a guided approach.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_activemqartemis_custom_resource_for_a_two_node_cluster"><a class="anchor" href="#_creating_an_activemqartemis_custom_resource_for_a_two_node_cluster"></a>Creating an ActiveMQArtemis Custom Resource for a Two-Node Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the Red Hat AMQ Operator is installed, you can define your ActiveMQ Artemis cluster using an <code>ActiveMQArtemis</code> Custom Resource (CR). This CR specifies the desired state of your broker deployment, and the Operator will work to achieve and maintain that state. The objective is to deploy a two-node ActiveMQ Artemis cluster. While the provided CR snippet details a single broker&#8217;s configuration, to achieve a two-node cluster, the Operator typically manages scaling through a <code>deployment</code> specification within the <code>spec</code> of the <code>ActiveMQArtemis</code> CR.</p>
</div>
<div class="olist arabic">
<div class="title">Hands-on Activity: Defining the ActiveMQArtemis Custom Resource</div>
<ol class="arabic">
<li>
<p><strong>Create a Project/Namespace</strong>: If you haven&#8217;t already, create a new OpenShift project (namespace) for your broker instance, for example, <code>broker</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project broker</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Define the Custom Resource</strong>: Create a YAML file named <code>broker-cluster.yaml</code> with the following content. This CR defines a basic ActiveMQ Artemis broker with an acceptor, and the <code>spec.deployment.replicas: 2</code> field (a common Operator pattern) instructs the Operator to deploy two broker instances for our cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: broker-cluster
  namespace: broker # Ensure this matches your project/namespace
spec:
  deployment:
    replicas: 2 <i class="conum" data-value="1"></i><b>(1)</b>
  acceptors:
    - bindToAllInterfaces: true
      connectionsAllowed: -1
      expose: true
      name: broker
      port: 61617
      sslEnabled: true
      sslSecret: tls <i class="conum" data-value="2"></i><b>(2)</b>
  addressSettings:
    addressSetting:
      - match: '#'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This crucial field instructs the Operator to deploy two instances of the ActiveMQ Artemis broker, forming our two-node cluster.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requires a Kubernetes <code>Secret</code> named <code>tls</code> containing your TLS certificate and key for SSL/TLS enabled communication.</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Apply the Custom Resource</strong>: Apply this YAML file to your OpenShift cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f broker-cluster.yaml</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Verify Deployment</strong>: The Operator will now begin provisioning the two ActiveMQ Artemis broker pods. You can monitor their status.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get ActiveMQArtemis -n broker
oc get pods -n broker -l app.kubernetes.io/name=broker-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see two pods related to <code>broker-cluster</code> in a <code>Running</code> state.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_broker_services_for_client_connections"><a class="anchor" href="#_configuring_broker_services_for_client_connections"></a>Configuring Broker Services for Client Connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>acceptors</code> section within the <code>ActiveMQArtemis</code> Custom Resource is fundamental for defining how clients connect to the ActiveMQ Artemis brokers. It specifies the network endpoints that the broker listens on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>acceptors</code></strong>: This is a list of network listeners. Each entry in the list defines a specific way clients can connect.</p>
</li>
<li>
<p><strong><code>bindToAllInterfaces: true</code></strong>: This setting ensures that the acceptor binds to all available network interfaces within the pod, making it accessible from other pods in the OpenShift cluster.</p>
</li>
<li>
<p><strong><code>connectionsAllowed: -1</code></strong>: A value of <code>-1</code> means an unlimited number of client connections are allowed on this acceptor.</p>
</li>
<li>
<p><strong><code>expose: true</code></strong>: This is a critical setting. When <code>expose</code> is set to <code>true</code>, the AMQ Operator automatically creates an OpenShift <code>Service</code> and <code>Route</code> (for external access) or a <code>Service</code> (for internal access) that exposes the broker&#8217;s acceptor port. This makes the broker accessible to client applications running inside or outside the OpenShift cluster.</p>
</li>
<li>
<p><strong><code>name: broker</code></strong>: A logical name for this specific acceptor configuration.</p>
</li>
<li>
<p><strong><code>port: 61617</code></strong>: This is the TCP port on which the broker listens for incoming connections. ActiveMQ Artemis typically uses 61616 for OpenWire, but 61617 is often used for AMQP/Artemis native clients with SSL.</p>
</li>
<li>
<p><strong><code>sslEnabled: true</code></strong>: Enables SSL/TLS encryption for all connections made to this acceptor, enhancing security.</p>
</li>
<li>
<p><strong><code>sslSecret: tls</code></strong>: Specifies the name of a Kubernetes <code>Secret</code> that contains the necessary TLS certificate and private key. This secret must exist in the same namespace as the ActiveMQ Artemis deployment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By configuring <code>expose: true</code> on an acceptor, the Operator simplifies the networking aspect, allowing client applications to discover and connect to the broker instances without manual <code>Service</code> or <code>Route</code> creation. This automatically generated service provides a stable network endpoint for the cluster members.</p>
</div>
<div class="paragraph">
<p>With the two-node cluster deployed and its services exposed, the next step involves developing client applications that can connect to these brokers and distribute messages evenly, optimizing for high throughput and leveraging the cluster&#8217;s high availability capabilities. This setup directly addresses client-side bottlenecks by allowing clients to connect to multiple brokers, reducing the reliance on message redistribution which, as mentioned in the context, "reduces overall cluster throughput and can force high-volume queues to page pending messages to disk."</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="setting-up-the-openshift-environment-for-amq-deployment.html">Setting up the OpenShift environment for AMQ deployment</a></span>
  <span class="next"><a href="developing-and-deploying-client-applications.html">Developing and deploying client applications</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
