<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Uneven message distribution across brokers :: Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</title>
    <link rel="prev" href="the-problem-with-a-multi-node-broker.html">
    <link rel="next" href="connection-pooling-issues-and-their-impact-on-message-distribution.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../mom-overview/mom-overview.html">MOM Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-overview/definition-and-importance-of-mom-in-distributed-applications.html">Definition and importance of MOM in distributed applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-overview/key-features-of-mom-loose-coupling-scalability-faster-response-high-availability-and-reliability.html">Key features of MOM: loose coupling, scalability, faster response, high availability, and reliability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../activemq-artemis-broker-overview/activemq-artemis-broker-overview.html">ActiveMQ Artemis Broker Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/introduction-to-activemq-artemis.html">Introduction to ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/key-components-message-queues-topics-and-addresses.html">Key components: message queues, topics, and addresses</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/configuration-options-for-high-performance-and-reliability.html">Configuration options for high performance and reliability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/activemq-artemis-deployment-on-openshift.html">ActiveMQ Artemis Deployment on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/overview-of-openshift-and-its-benefits-for-deploying-mom.html">Overview of OpenShift and its benefits for deploying MOM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/steps-to-deploy-activemq-artemis-on-openshift.html">Steps to deploy ActiveMQ Artemis on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/configuring-services-and-routes-for-load-balancing.html">Configuring services and routes for load balancing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="the-problem-with-a-multi-node-broker.html">The Problem with a Multi-Node Broker</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="uneven-message-distribution-across-brokers.html">Uneven message distribution across brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connection-pooling-issues-and-their-impact-on-message-distribution.html">Connection pooling issues and their impact on message distribution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="the-problem-of-uneven-load-distribution-and-its-consequences.html">The problem of uneven load distribution and its consequences</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../the-client-side-solution/the-client-side-solution.html">The Client-Side Solution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-client-side-solution/connection-rebalancing-and-best-practices.html">Connection rebalancing and best practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-client-side-solution/configuring-quarkus-for-jms-client-connections.html">Configuring Quarkus for JMS client connections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-client-side-solution/using-jmspoolconnectionfactory-for-efficient-connection-management.html">Using JmsPoolConnectionFactory for efficient connection management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-client-side-solution/implementing-failover-and-retry-mechanisms.html">Implementing failover and retry mechanisms</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a></li>
    <li><a href="the-problem-with-a-multi-node-broker.html">The Problem with a Multi-Node Broker</a></li>
    <li><a href="uneven-message-distribution-across-brokers.html">Uneven message distribution across brokers</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Uneven message distribution across brokers</h1>
<div class="sect1">
<h2 id="_uneven_message_distribution_across_brokers"><a class="anchor" href="#_uneven_message_distribution_across_brokers"></a>Uneven Message Distribution Across Brokers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a multi-node ActiveMQ Artemis broker cluster, uneven message distribution across brokers can occur due to the lack of even connection distribution. This issue arises when a client connects to a JMS-specific broker cluster, such as ActiveMQ Artemis, and most connection management mechanisms are not configured for an even distribution of connections across all members of the cluster.</p>
</div>
<div class="paragraph">
<p>When an application does not use a connection pooling mechanism, it typically creates one connection that can only be served by one broker. This introduces the problem of uneven message distribution, as messages are not balanced across all brokers in the cluster. Although messages can move between nodes if a non-negative redistribution-delay is configured for an address, this reduces the cluster throughput and may even lead to paging pending messages to disk for queues with a high incoming message rate.</p>
</div>
<div class="paragraph">
<p>This uneven distribution can be exacerbated when modern application frameworks like Spring Boot or Quarkus create and scale connections on demand. Since brokers generally handle connections independently, this results in a connection disparity between the two nodes, which in turn affects consumers.</p>
</div>
<div class="paragraph">
<p>To address this issue, it is essential to implement connection rebalancing and best practices. This will ensure that messages are evenly distributed across the brokers in the cluster, enhancing overall system performance and reliability.</p>
</div>
<div class="paragraph">
<p><strong>Hands-on Activity: Verifying Uneven Message Distribution</strong></p>
</div>
<div class="paragraph">
<p>To verify the uneven message distribution across brokers, you can run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec broker-&lt;node-name&gt; -- /home/jboss/amq-broker/bin/artemis queue stat --url tcp://broker-&lt;node-name&gt;:61616 --clustered --user admin --password admin --queueName &lt;queue-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;node-name&gt;</code> with the appropriate broker node name (e.g., <code>broker-ss-0</code> or <code>broker-ss-1</code>) and <code>&lt;queue-name&gt;</code> with the desired queue name (e.g., <code>prices</code>). This command will display the message and connection statistics for the specified queue on each broker node, allowing you to assess the distribution.</p>
</div>
<div class="paragraph">
<p>By understanding and addressing the issue of uneven message distribution across brokers, you can optimize your ActiveMQ Artemis deployment on OpenShift and ensure high availability and reliability for your distributed applications.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="the-problem-with-a-multi-node-broker.html">The Problem with a Multi-Node Broker</a></span>
  <span class="next"><a href="connection-pooling-issues-and-their-impact-on-message-distribution.html">Connection pooling issues and their impact on message distribution</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
