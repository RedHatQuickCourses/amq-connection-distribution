<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Connection rebalancing and best practices :: Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</title>
    <link rel="prev" href="the-client-side-solution.html">
    <link rel="next" href="configuring-quarkus-for-jms-client-connections.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../mom-overview/mom-overview.html">MOM Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-overview/definition-and-importance-of-mom-in-distributed-applications.html">Definition and importance of MOM in distributed applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-overview/key-features-of-mom-loose-coupling-scalability-faster-response-high-availability-and-reliability.html">Key features of MOM: loose coupling, scalability, faster response, high availability, and reliability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../activemq-artemis-broker-overview/activemq-artemis-broker-overview.html">ActiveMQ Artemis Broker Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/introduction-to-activemq-artemis.html">Introduction to ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/key-components-message-queues-topics-and-addresses.html">Key components: message queues, topics, and addresses</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/configuration-options-for-high-performance-and-reliability.html">Configuration options for high performance and reliability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/activemq-artemis-deployment-on-openshift.html">ActiveMQ Artemis Deployment on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/overview-of-openshift-and-its-benefits-for-deploying-mom.html">Overview of OpenShift and its benefits for deploying MOM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/steps-to-deploy-activemq-artemis-on-openshift.html">Steps to deploy ActiveMQ Artemis on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/configuring-services-and-routes-for-load-balancing.html">Configuring services and routes for load balancing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/the-problem-with-a-multi-node-broker.html">The Problem with a Multi-Node Broker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/uneven-message-distribution-across-brokers.html">Uneven message distribution across brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/connection-pooling-issues-and-their-impact-on-message-distribution.html">Connection pooling issues and their impact on message distribution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/the-problem-of-uneven-load-distribution-and-its-consequences.html">The problem of uneven load distribution and its consequences</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="the-client-side-solution.html">The Client-Side Solution</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="connection-rebalancing-and-best-practices.html">Connection rebalancing and best practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-quarkus-for-jms-client-connections.html">Configuring Quarkus for JMS client connections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using-jmspoolconnectionfactory-for-efficient-connection-management.html">Using JmsPoolConnectionFactory for efficient connection management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implementing-failover-and-retry-mechanisms.html">Implementing failover and retry mechanisms</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a></li>
    <li><a href="the-client-side-solution.html">The Client-Side Solution</a></li>
    <li><a href="connection-rebalancing-and-best-practices.html">Connection rebalancing and best practices</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Connection rebalancing and best practices</h1>
<div class="sect1">
<h2 id="_connection_rebalancing_and_best_practices"><a class="anchor" href="#_connection_rebalancing_and_best_practices"></a>Connection Rebalancing and Best Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a multi-node broker setup, such as an ActiveMQ Artemis cluster, it&#8217;s crucial to ensure even distribution of messages across all brokers to optimize performance and reliability. However, most modern application frameworks like Spring Boot or Quarkus create and scale connections on demand, leading to connection disparity between nodes and affecting message distribution.</p>
</div>
<div class="sect2">
<h3 id="_problem_with_uneven_message_distribution"><a class="anchor" href="#_problem_with_uneven_message_distribution"></a>Problem with Uneven Message Distribution</h3>
<div class="paragraph">
<p>When a client connects to a JMS-specific broker cluster, such as ActiveMQ Artemis, the default connection management mechanisms are not typically configured for even distribution of connections across all cluster members. If the application does not employ a connection pooling mechanism, it usually creates a single connection that can only be served by one broker. This results in uneven message distribution across brokers, which can negatively impact the overall system performance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_solution_connection_rebalancing_and_best_practices"><a class="anchor" href="#_solution_connection_rebalancing_and_best_practices"></a>Solution: Connection Rebalancing and Best Practices</h3>
<div class="paragraph">
<p>To address the issue of uneven message distribution, we can implement connection rebalancing and follow best practices for managing JMS client connections.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Connection Rebalancing</strong>: To achieve even distribution, create a new service targeting both pods in your OpenShift deployment. This ensures that connections are balanced between the two nodes.</p>
</li>
<li>
<p><strong>JmsPoolConnectionFactory</strong>: Wrap your connection factory with the JmsPoolConnectionFactory provided by the pooled-jms library from messaginghub. This separation of producer and consumer connection factories allows you to set the maximum connections greater than or equal to the number of brokers in the cluster.</p>
</li>
<li>
<p><strong>Connection Pooling</strong>: Implement a connection pooling mechanism to manage producer and consumer connections efficiently. This approach enables the application to create multiple connections that can be served by any broker in the cluster, promoting even message distribution.</p>
</li>
<li>
<p><strong>Configuring Quarkus for JMS Client Connections</strong>: When using Quarkus, configure it to work with JmsPoolConnectionFactory for efficient connection management. This ensures that your application can take full advantage of connection pooling and rebalancing.</p>
</li>
<li>
<p><strong>Failover and Retry Mechanisms</strong>: Implement failover and retry mechanisms to handle potential disconnections and maintain high availability. This ensures that your application remains resilient in the face of network issues or broker failures.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By following these best practices, you can ensure even message distribution across brokers in an ActiveMQ Artemis cluster, enhancing the overall performance, reliability, and scalability of your distributed applications.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="the-client-side-solution.html">The Client-Side Solution</a></span>
  <span class="next"><a href="configuring-quarkus-for-jms-client-connections.html">Configuring Quarkus for JMS client connections</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
