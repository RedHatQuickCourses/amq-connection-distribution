<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using JmsPoolConnectionFactory for efficient connection management :: Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</title>
    <link rel="prev" href="configuring-quarkus-for-jms-client-connections.html">
    <link rel="next" href="implementing-failover-and-retry-mechanisms.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../mom-overview/mom-overview.html">MOM Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-overview/definition-and-importance-of-mom-in-distributed-applications.html">Definition and importance of MOM in distributed applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-overview/key-features-of-mom-loose-coupling-scalability-faster-response-high-availability-and-reliability.html">Key features of MOM: loose coupling, scalability, faster response, high availability, and reliability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../activemq-artemis-broker-overview/activemq-artemis-broker-overview.html">ActiveMQ Artemis Broker Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/introduction-to-activemq-artemis.html">Introduction to ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/key-components-message-queues-topics-and-addresses.html">Key components: message queues, topics, and addresses</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-broker-overview/configuration-options-for-high-performance-and-reliability.html">Configuration options for high performance and reliability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/activemq-artemis-deployment-on-openshift.html">ActiveMQ Artemis Deployment on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/overview-of-openshift-and-its-benefits-for-deploying-mom.html">Overview of OpenShift and its benefits for deploying MOM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/steps-to-deploy-activemq-artemis-on-openshift.html">Steps to deploy ActiveMQ Artemis on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../activemq-artemis-deployment-on-openshift/configuring-services-and-routes-for-load-balancing.html">Configuring services and routes for load balancing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/the-problem-with-a-multi-node-broker.html">The Problem with a Multi-Node Broker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/uneven-message-distribution-across-brokers.html">Uneven message distribution across brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/connection-pooling-issues-and-their-impact-on-message-distribution.html">Connection pooling issues and their impact on message distribution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../the-problem-with-a-multi-node-broker/the-problem-of-uneven-load-distribution-and-its-consequences.html">The problem of uneven load distribution and its consequences</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="the-client-side-solution.html">The Client-Side Solution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connection-rebalancing-and-best-practices.html">Connection rebalancing and best practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-quarkus-for-jms-client-connections.html">Configuring Quarkus for JMS client connections</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="using-jmspoolconnectionfactory-for-efficient-connection-management.html">Using JmsPoolConnectionFactory for efficient connection management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implementing-failover-and-retry-mechanisms.html">Implementing failover and retry mechanisms</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Message Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift</a></li>
    <li><a href="the-client-side-solution.html">The Client-Side Solution</a></li>
    <li><a href="using-jmspoolconnectionfactory-for-efficient-connection-management.html">Using JmsPoolConnectionFactory for efficient connection management</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Using JmsPoolConnectionFactory for efficient connection management</h1>
<div class="sect1">
<h2 id="_using_jmspoolconnectionfactory_for_efficient_connection_management"><a class="anchor" href="#_using_jmspoolconnectionfactory_for_efficient_connection_management"></a>Using JmsPoolConnectionFactory for Efficient Connection Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the context of Message-Oriented Middleware (MOM) with ActiveMQ Artemis on OpenShift, efficient connection management is crucial for maintaining high performance and reliability. One of the key tools for achieving this is the <code>JmsPoolConnectionFactory</code> provided by the pooled-jms library from messaginghub.</p>
</div>
<div class="sect2">
<h3 id="_why_use_jmspoolconnectionfactory"><a class="anchor" href="#_why_use_jmspoolconnectionfactory"></a>Why Use JmsPoolConnectionFactory?</h3>
<div class="paragraph">
<p>The <code>JmsPoolConnectionFactory</code> separates producer and consumer connection factories, allowing for better control and management of connections. This separation is essential in a multi-node broker environment, where uneven message distribution and connection pooling issues can significantly impact message distribution and system performance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_jmspoolconnectionfactory"><a class="anchor" href="#_configuring_jmspoolconnectionfactory"></a>Configuring JmsPoolConnectionFactory</h3>
<div class="paragraph">
<p>To configure <code>JmsPoolConnectionFactory</code>, you need to set the maximum connections (<code>setMaxConnections</code>) to a value equal to or greater than the number of brokers in your cluster. This ensures that connections are evenly distributed across all brokers, preventing uneven load distribution and its consequences.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of how to configure <code>JmsPoolConnectionFactory</code> for both producers and consumers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Produces
@Identifier("pcfProducer")
public JmsPoolConnectionFactory pcfProducer() throws Exception {
    ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(url);
    JmsPoolConnectionFactory poolConnectionFactory = new JmsPoolConnectionFactory();
    poolConnectionFactory.setConnectionFactory(activeMQConnectionFactory);
    poolConnectionFactory.setMaxConnections(5); //max connections should be set equal to or more than the number of brokers
    poolConnectionFactory.setMaxSessionsPerConnection(500);
    return poolConnectionFactory;
}

@Produces
@Identifier("pcfConsumer")
public JmsPoolConnectionFactory pcfConsumer() throws Exception {
    ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(url);
    JmsPoolConnectionFactory poolConnectionFactory = new JmsPoolConnectionFactory();
    poolConnectionFactory.setConnectionFactory(activeMQConnectionFactory);
    poolConnectionFactory.setMaxConnections(5); //max connections should be set equal to or more than the number of brokers
    poolConnectionFactory.setMaxSessionsPerConnection(1);
    return poolConnectionFactory;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_consumer_application_configuration"><a class="anchor" href="#_consumer_application_configuration"></a>Consumer Application Configuration</h3>
<div class="paragraph">
<p>In the consumer application, it&#8217;s important to create the same number of consumers as the number of max connections in the consumer connection factory. This ensures that all connections (and by association, the consumers) are created</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configuring-quarkus-for-jms-client-connections.html">Configuring Quarkus for JMS client connections</a></span>
  <span class="next"><a href="implementing-failover-and-retry-mechanisms.html">Implementing failover and retry mechanisms</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
