<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying Quarkus messaging applications on OpenShift :: Understanding and Implementing Message Oriented Middleware</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Understanding and Implementing Message Oriented Middleware</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Understanding and Implementing Message Oriented Middleware</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction-to-message-oriented-middleware-mom/introduction-to-message-oriented-middleware-mom.html">Introduction to Message Oriented Middleware (MOM)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-message-oriented-middleware-mom/what-is-message-oriented-middleware.html">What is Message Oriented Middleware?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-message-oriented-middleware-mom/core-concepts-messages-producers-consumers-brokers.html">Core concepts: Messages, Producers, Consumers, Brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-message-oriented-middleware-mom/benefits-of-mom-in-distributed-systems.html">Benefits of MOM in distributed systems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction-to-message-oriented-middleware-mom/common-use-cases-for-mom.html">Common use cases for MOM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../challenges-in-distributed-systems/challenges-in-distributed-systems.html">Challenges in Distributed Systems</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-in-distributed-systems/issues-with-direct-service-to-service-communication.html">Issues with direct service-to-service communication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-in-distributed-systems/the-need-for-asynchronous-processing.html">The need for asynchronous processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-in-distributed-systems/problems-with-reliability-and-data-consistency.html">Problems with reliability and data consistency</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-in-distributed-systems/scalability-and-coupling-concerns.html">Scalability and coupling concerns</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../mom-solutions-for-distributed-systems/mom-solutions-for-distributed-systems.html">MOM Solutions for Distributed Systems</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-solutions-for-distributed-systems/decoupling-services-with-message-queues.html">Decoupling services with message queues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-solutions-for-distributed-systems/point-to-point-ptp-messaging-model.html">Point-to-Point (PTP) messaging model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-solutions-for-distributed-systems/publishsubscribe-pubsub-messaging-model.html">Publish/Subscribe (Pub/Sub) messaging model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-solutions-for-distributed-systems/ensuring-message-delivery-and-reliability.html">Ensuring message delivery and reliability</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mom-solutions-for-distributed-systems/message-persistence-and-durability.html">Message persistence and durability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab-implementing-messaging-patterns/hands-on-lab-implementing-messaging-patterns.html">Hands-on Lab: Implementing Messaging Patterns</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-implementing-messaging-patterns/setting-up-a-basic-message-broker.html">Setting up a basic message broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-implementing-messaging-patterns/developing-a-producer-for-point-to-point-messaging.html">Developing a producer for Point-to-Point messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-implementing-messaging-patterns/developing-a-consumer-for-point-to-point-messaging.html">Developing a consumer for Point-to-Point messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-implementing-messaging-patterns/implementing-a-publisher-for-publishsubscribe.html">Implementing a publisher for Publish/Subscribe</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-implementing-messaging-patterns/implementing-a-subscriber-for-publishsubscribe.html">Implementing a subscriber for Publish/Subscribe</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Understanding and Implementing Message Oriented Middleware</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Understanding and Implementing Message Oriented Middleware</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Understanding and Implementing Message Oriented Middleware</a></li>
    <li><a href="deploying-quarkus-messaging-applications-on-openshift.html">Deploying Quarkus messaging applications on OpenShift</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Deploying Quarkus messaging applications on OpenShift</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This content covers the deployment of Quarkus messaging applications on OpenShift, integrating with an ActiveMQ Artemis broker. It includes technical explanations and a hands-on lab activity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_quarkus_messaging_applications_on_openshift"><a class="anchor" href="#_deploying_quarkus_messaging_applications_on_openshift"></a>Deploying Quarkus Messaging Applications on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Deploying Quarkus messaging applications on OpenShift combines the lightweight, high-performance nature of Quarkus with the robust orchestration capabilities of OpenShift, creating an ideal environment for cloud-native messaging solutions. This section will guide you through the process, focusing on best practices for integration with ActiveMQ Artemis.</p>
</div>
<div class="sect2">
<h3 id="_understanding_quarkus_on_openshift"><a class="anchor" href="#_understanding_quarkus_on_openshift"></a>Understanding Quarkus on OpenShift</h3>
<div class="paragraph">
<p>Quarkus applications are particularly well-suited for OpenShift due to their low memory footprint and fast startup times, especially when built as native executables using GraalVM. OpenShift, being a Kubernetes distribution, provides an enterprise-grade platform for deploying, scaling, and managing containerized applications.</p>
</div>
<div class="paragraph">
<p>When deploying a Quarkus messaging application that interacts with ActiveMQ Artemis, key considerations include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Connectivity:</strong> How the Quarkus application discovers and connects to the ActiveMQ Artemis cluster within the OpenShift network.</p>
</li>
<li>
<p><strong>Configuration:</strong> Managing connection details, credentials, and other application-specific settings securely and efficiently.</p>
</li>
<li>
<p><strong>Build and Deployment Strategy:</strong> Choosing the most effective way to build and deploy your Quarkus application containers.</p>
</li>
<li>
<p><strong>Scaling and Resiliency:</strong> Ensuring your messaging application can scale horizontally and remain available.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_strategies_for_quarkus_on_openshift"><a class="anchor" href="#_deployment_strategies_for_quarkus_on_openshift"></a>Deployment Strategies for Quarkus on OpenShift</h3>
<div class="paragraph">
<p>OpenShift offers several methods to deploy applications. For Quarkus, common strategies include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Source-to-Image (S2I):</strong> This is a popular and convenient method. S2I takes your application source code and injects it into a builder image (e.g., a Quarkus S2I builder or an OpenJDK builder) to produce a ready-to-run image. OpenShift handles the build process and then deploys the resulting image.</p>
</li>
<li>
<p><strong>Container Images (Dockerfile Strategy):</strong> You provide a <code>Dockerfile</code> that OpenShift uses to build a custom container image from your source code. This offers more control over the build process and environment.</p>
</li>
<li>
<p><strong>Pre-built Images:</strong> You can push a pre-built Quarkus container image (e.g., from a CI/CD pipeline) to an OpenShift internal registry or an external registry, and then deploy it directly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For educational purposes and typical development workflows, <strong>Source-to-Image (S2I)</strong> is often the simplest way to get started with Quarkus on OpenShift.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_quarkus_for_activemq_artemis_connectivity_on_openshift"><a class="anchor" href="#_configuring_quarkus_for_activemq_artemis_connectivity_on_openshift"></a>Configuring Quarkus for ActiveMQ Artemis Connectivity on OpenShift</h3>
<div class="paragraph">
<p>When running Quarkus applications on OpenShift, it&#8217;s crucial to manage configuration dynamically. Instead of hardcoding values, you should leverage OpenShift&#8217;s mechanisms for injecting configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Environment Variables:</strong> OpenShift can inject environment variables into your application containers. This is commonly used for connection strings, hostnames, and ports.</p>
</li>
<li>
<p><strong>ConfigMaps:</strong> For more complex configurations or properties files, ConfigMaps allow you to store non-sensitive data as key-value pairs and mount them into your pods or inject them as environment variables.</p>
</li>
<li>
<p><strong>Secrets:</strong> For sensitive data like passwords or API keys, Secrets provide a secure way to store and inject credentials into your application containers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For connecting to ActiveMQ Artemis, your Quarkus application will typically require:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Artemis broker hostname and port.</p>
</li>
<li>
<p>User credentials (if security is enabled).</p>
</li>
<li>
<p>Any specific JMS/AMQP client settings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These can be externalized using environment variables in your <code>application.properties</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Example for JMS configuration
quarkus.artemis.url=tcp://${ARTEMIS_HOST}:${ARTEMIS_PORT}?ha=true
quarkus.artemis.username=${ARTEMIS_USERNAME}
quarkus.artemis.password=${ARTEMIS_PASSWORD}

# Example for AMQP configuration (if using reactive messaging with AMQP)
quarkus.smallrye-reactive-messaging.brokers.my-artemis-broker.host=${ARTEMIS_HOST}
quarkus.smallrye-reactive-messaging.brokers.my-artemis-broker.port=${ARTEMIS_PORT}
quarkus.smallrye-reactive-messaging.brokers.my-artemis-broker.username=${ARTEMIS_USERNAME}
quarkus.smallrye-reactive-messaging.brokers.my-artemis-broker.password=${ARTEMIS_PASSWORD}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying to OpenShift, you would set these <code>ARTEMIS_HOST</code>, <code>ARTEMIS_PORT</code>, <code>ARTEMIS_USERNAME</code>, and <code>ARTEMIS_PASSWORD</code> environment variables during the <code>oc new-app</code> command or via a deployment configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hands_on_lab_deploying_a_quarkus_microservice_with_distributed_messaging_on_openshift"><a class="anchor" href="#_hands_on_lab_deploying_a_quarkus_microservice_with_distributed_messaging_on_openshift"></a>Hands-on Lab: Deploying a Quarkus Microservice with Distributed Messaging on OpenShift</h3>
<div class="paragraph">
<p>This lab will guide you through deploying a simple Quarkus messaging application on OpenShift that connects to an existing ActiveMQ Artemis cluster. The application will demonstrate sending and receiving messages.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h4>
<div class="paragraph">
<p>Before starting this lab, ensure you have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An OpenShift cluster (CRC, Minishift, OpenShift Dedicated, OCP).</p>
</li>
<li>
<p>The <code>oc</code> command-line tool configured and logged in to your OpenShift cluster.</p>
</li>
<li>
<p>Maven or Gradle installed locally.</p>
</li>
<li>
<p>An ActiveMQ Artemis cluster successfully deployed on OpenShift (refer to the "Deploying a highly available ActiveMQ Artemis cluster on OpenShift" lab if needed). Make sure you know its service name and port. For this lab, we&#8217;ll assume the Artemis service is named <code>artemis-cluster-external</code> and accessible on port <code>61616</code> within the OpenShift project.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_lab_objectives"><a class="anchor" href="#_lab_objectives"></a>Lab Objectives</h4>
<div class="ulist">
<ul>
<li>
<p>Create a simple Quarkus messaging application.</p>
</li>
<li>
<p>Configure the Quarkus application to connect to ActiveMQ Artemis.</p>
</li>
<li>
<p>Deploy the Quarkus application to OpenShift using S2I.</p>
</li>
<li>
<p>Verify message production and consumption within the OpenShift environment.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_step_1_create_a_quarkus_messaging_project"><a class="anchor" href="#_step_1_create_a_quarkus_messaging_project"></a>Step 1: Create a Quarkus Messaging Project</h4>
<div class="paragraph">
<p>First, let&#8217;s create a new Quarkus project with the necessary dependencies for JMS.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Generate the Quarkus project:</strong>
Use the Quarkus CLI or Maven to generate a new project.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
mvn io.quarkus.platform:quarkus-maven-plugin:3.8.3:create \
    -DprojectGroupId=org.quarkus.artemis \
    -DprojectArtifactId=quarkus-artemis-consumer-producer \
    -Dextensions="resteasy-reactive,quarkus-qpid-jms" \
    -DnoExamples=true
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This creates a project named `quarkus-artemis-consumer-producer` with `quarkus-resteasy-reactive` (for a simple REST endpoint) and `quarkus-qpid-jms` (for JMS connectivity).</pre>
</div>
</div>
</li>
<li>
<p><strong>Navigate into the project directory:</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
cd quarkus-artemis-consumer-producer
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Update <code>src/main/resources/application.properties</code>:</strong>
Configure the Artemis connection properties using environment variables.</p>
<div class="literalblock">
<div class="content">
<pre>[source,properties]
----
# HTTP server port for our REST endpoint
quarkus.http.port=8080</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># ActiveMQ Artemis JMS client configuration
quarkus.artemis.url=tcp://${ARTEMIS_SERVICE_HOST}:${ARTEMIS_SERVICE_PORT}?ha=true
quarkus.artemis.username=${ARTEMIS_USERNAME}
quarkus.artemis.password=${ARTEMIS_PASSWORD}
quarkus.artemis.global-enabled=true</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># Enable health checks for Quarkus
quarkus.smallrye-health.enabled=true
quarkus.devservices.enabled=false # Disable Dev Services for production deployment
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Create a Producer Service (<code>src/main/java/org/quarkus/artemis/ProducerService.java</code>):</strong>
This service will expose a REST endpoint to send messages to an Artemis queue.</p>
<div class="literalblock">
<div class="content">
<pre>[source,java]
----
package org.quarkus.artemis;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>import io.quarkus.logging.Log;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;
import jakarta.jms.ConnectionFactory;
import jakarta.jms.JMSContext;
import jakarta.jms.Session;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.QueryParam;
import jakarta.ws.rs.core.MediaType;
import jakarta.ws.rs.core.Response;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@ApplicationScoped
@Path("/messages")
public class ProducerService {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Inject
ConnectionFactory connectionFactory;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final String QUEUE_NAME = "myQueue";</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@GET
@Path("/send")
@Produces(MediaType.TEXT_PLAIN)
public Response sendMessage(@QueryParam("text") String messageText) {
    if (messageText == null || messageText.trim().isEmpty()) {
        messageText = "Hello from Quarkus at " + System.currentTimeMillis();
    }</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    try (JMSContext context = connectionFactory.createContext(Session.AUTO_ACKNOWLEDGE)) {
        context.createProducer().send(context.createQueue(QUEUE_NAME), messageText);
        Log.infof("Sent message: %s to queue %s", messageText, QUEUE_NAME);
        return Response.ok("Message sent: " + messageText).build();
    } catch (Exception e) {
        Log.errorf(e, "Error sending message: %s", e.getMessage());
        return Response.serverError().entity("Failed to send message: " + e.getMessage()).build();
    }
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    @GET
    @Path("/hello")
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return "Hello from Quarkus Producer!";
    }
}
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Create a Consumer Service (<code>src/main/java/org/quarkus/artemis/ConsumerService.java</code>):</strong>
This service will listen for messages on the specified Artemis queue.</p>
<div class="literalblock">
<div class="content">
<pre>[source,java]
----
package org.quarkus.artemis;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>import io.quarkus.logging.Log;
import io.quarkus.artemis.jms.annotations.JmsListener;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.jms.Message;
import jakarta.jms.TextMessage;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@ApplicationScoped
public class ConsumerService {</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>private static final String QUEUE_NAME = "myQueue";</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    @JmsListener(destination = QUEUE_NAME)
    public void processMessage(Message message) {
        try {
            if (message instanceof TextMessage textMessage) {
                Log.infof("Received message: %s from queue %s", textMessage.getText(), QUEUE_NAME);
                // You can add more processing logic here
            } else {
                Log.warnf("Received non-text message: %s", message.getClass().getName());
            }
        } catch (Exception e) {
            Log.errorf(e, "Error processing message: %s", e.getMessage());
        }
    }
}
----</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_prepare_openshift_project"><a class="anchor" href="#_step_2_prepare_openshift_project"></a>Step 2: Prepare OpenShift Project</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Log in to OpenShift:</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc login --token=&lt;YOUR_TOKEN&gt; --server=&lt;YOUR_OPENSHIFT_API_URL&gt;
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Create a new OpenShift project (if you don&#8217;t have one):</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc new-project quarkus-messaging-demo
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Verify Artemis Service:</strong>
Ensure your Artemis cluster is running in the <strong>same</strong> or an <strong>accessible</strong> OpenShift project. Get the external service name and port.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc get svc -n &lt;your-artemis-project&gt;
# Look for a service like 'artemis-cluster-external' or similar.
# Note down its name and port (usually 61616).
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>For this lab, we'll assume the external service is named `artemis-cluster-external` and accessible on port `61616` within the `quarkus-messaging-demo` project.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>NOTE: If Artemis is in a different project, you'll need to specify its fully qualified domain name (FQDN) like `artemis-cluster-external.artemis-project.svc.cluster.local`. For simplicity, we assume it's in the same project or accessible directly via its service name.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_deploy_the_quarkus_application_to_openshift_using_s2i"><a class="anchor" href="#_step_3_deploy_the_quarkus_application_to_openshift_using_s2i"></a>Step 3: Deploy the Quarkus Application to OpenShift using S2I</h4>
<div class="paragraph">
<p>Now, we&#8217;ll use OpenShift&#8217;s S2I capabilities to build and deploy our Quarkus application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Deploy using <code>oc new-app</code>:</strong>
This command will:</p>
<div class="ulist">
<ul>
<li>
<p>Create a <code>BuildConfig</code> using the <code>quarkus/quarkus-s2i</code> builder image.</p>
</li>
<li>
<p>Trigger a build from your local source code.</p>
</li>
<li>
<p>Create a <code>Deployment</code> and <code>Service</code> for your application.</p>
</li>
<li>
<p>Set the necessary environment variables for Artemis connectivity.</p>
<div class="literalblock">
<div class="content">
<pre>Replace `artemis-cluster-external` and `61616` with your actual Artemis service name and port if they differ. Replace `ARTEMIS_USER` and `ARTEMIS_PASSWORD` with the credentials for your Artemis broker.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc new-app quarkus/quarkus-s2i~. \
    --name=quarkus-artemis-app \
    --env="ARTEMIS_SERVICE_HOST=artemis-cluster-external" \
    --env="ARTEMIS_SERVICE_PORT=61616" \
    --env="ARTEMIS_USERNAME=admin" \
    --env="ARTEMIS_PASSWORD=admin" \
    --allow-missing-images # Required if the builder image needs to be pulled for the first time
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>.Explanation of `oc new-app` parameters:
*   `quarkus/quarkus-s2i~.`: Specifies the S2I builder image (`quarkus/quarkus-s2i`) and indicates that the source code (`.`) is in the current directory. The `~` separates the builder image from the source location.
*   `--name=quarkus-artemis-app`: Sets the name for your application resources.
*   `--env="..."`: Sets environment variables within the deployed application pods. These match the variables we used in `application.properties`.
*   `--allow-missing-images`: Allows OpenShift to pull the builder image if it's not already cached.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Monitor the build and deployment:</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc get pods -w
----
You should see a `build` pod completing, followed by your `quarkus-artemis-app` pod starting up.</pre>
</div>
</div>
</li>
<li>
<p><strong>Check build logs (if issues occur):</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc logs -f bc/quarkus-artemis-app
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Check application logs:</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc logs -f deployment/quarkus-artemis-app
----
You should see messages from your `ConsumerService` attempting to connect to Artemis and potentially receiving messages if any were already in the queue.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_step_4_expose_the_application_and_test"><a class="anchor" href="#_step_4_expose_the_application_and_test"></a>Step 4: Expose the Application and Test</h4>
<div class="paragraph">
<p>To interact with the producer service&#8217;s REST endpoint, we need to expose the application via an OpenShift Route.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Expose the application service:</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc expose svc quarkus-artemis-app --port=8080
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Get the application URL:</strong></p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc get route quarkus-artemis-app -o jsonpath='{.spec.host}'
----
This will output the hostname for your application, e.g., `quarkus-artemis-app-quarkus-messaging-demo.apps.cluster.example.com`. Construct the full URL, including `http://` or `https://`.</pre>
</div>
</div>
</li>
<li>
<p><strong>Test the producer endpoint:</strong>
Open your web browser or use <code>curl</code> to send a message.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
# Replace &lt;APP_ROUTE_URL&gt; with the actual URL from the previous step
curl -X GET "http://&lt;APP_ROUTE_URL&gt;/messages/send?text=Hello_from_OpenShift!"
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>You should receive a `Message sent: Hello from OpenShift!` response.</pre>
</div>
</div>
</li>
<li>
<p><strong>Verify message consumption:</strong>
Check the logs of your <code>quarkus-artemis-app</code> pod. You should see log messages indicating that the consumer received the message.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc logs -f deployment/quarkus-artemis-app
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Look for output similar to: `INFO [org.qua.art.ConsumerService] (executor-thread-0) Received message: Hello_from_OpenShift! from queue myQueue`</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>You can also verify the `/messages/hello` endpoint:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
curl http://&lt;APP_ROUTE_URL&gt;/messages/hello
----
This should return `Hello from Quarkus Producer!`.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_step_5_clean_up_optional"><a class="anchor" href="#_step_5_clean_up_optional"></a>Step 5: Clean Up (Optional)</h4>
<div class="paragraph">
<p>To remove the resources created in this lab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete all -l app=quarkus-artemis-app
oc delete route quarkus-artemis-app
# If you created a new project for this lab, you can delete it:
oc delete project quarkus-messaging-demo</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lab demonstrated the end-to-end process of developing a Quarkus messaging application and deploying it to OpenShift, ensuring it connects and interacts with an ActiveMQ Artemis cluster. This pattern is fundamental for building resilient and scalable distributed messaging solutions on cloud-native platforms.</p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
