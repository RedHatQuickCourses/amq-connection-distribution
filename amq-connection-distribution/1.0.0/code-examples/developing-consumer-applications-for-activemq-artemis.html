<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developing consumer applications for ActiveMQ Artemis :: ActiveMQ Artemis Clustering and High Availability</title>
    <link rel="prev" href="developing-producer-applications-for-activemq-artemis.html">
    <link rel="next" href="connecting-clients-to-a-clustered-artemis-environment.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">ActiveMQ Artemis Clustering and High Availability</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-connection-distribution" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">ActiveMQ Artemis Clustering and High Availability</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../message-oriented-middleware-introduction/message-oriented-middleware-introduction.html">Message Oriented Middleware Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../message-oriented-middleware-introduction/role-of-mom-in-distributed-systems.html">Role of MOM in distributed systems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../message-oriented-middleware-introduction/benefits-of-asynchronous-communication.html">Benefits of asynchronous communication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../message-oriented-middleware-introduction/ensuring-resilience-and-reliability-with-mom.html">Ensuring resilience and reliability with MOM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../message-oriented-middleware-introduction/introduction-to-activemq-artemis.html">Introduction to ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../message-oriented-middleware-introduction/key-features-and-architecture-of-activemq-artemis.html">Key features and architecture of ActiveMQ Artemis</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../challenges-with-clustered-brokers/challenges-with-clustered-brokers.html">Challenges with clustered brokers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-with-clustered-brokers/uneven-connection-distribution-across-cluster-nodes.html">Uneven connection distribution across cluster nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-with-clustered-brokers/bottlenecks-from-single-connection-points.html">Bottlenecks from single connection points</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-with-clustered-brokers/overhead-and-impact-of-message-redistribution.html">Overhead and impact of message redistribution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-with-clustered-brokers/reduced-cluster-throughput-in-specific-scenarios.html">Reduced cluster throughput in specific scenarios</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../challenges-with-clustered-brokers/disk-paging-issues-for-high-volume-queues.html">Disk paging issues for high-volume queues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../solutions/solutions.html">Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/activemq-artemis-clustering-overview.html">ActiveMQ Artemis clustering overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/high-availability-ha-and-automatic-failover.html">High Availability (HA) and automatic failover</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/server-side-message-load-balancing.html">Server-side message load balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/scaling-with-competing-consumers.html">Scaling with competing consumers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/deploying-activemq-artemis-on-openshift.html">Deploying ActiveMQ Artemis on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/utilizing-the-red-hat-amq-operator.html">Utilizing the Red Hat AMQ Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../solutions/configuring-activemqartemis-custom-resources-for-clustering.html">Configuring ActiveMQArtemis Custom Resources for clustering</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="code-examples.html">Code Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developing-producer-applications-for-activemq-artemis.html">Developing producer applications for ActiveMQ Artemis</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="developing-consumer-applications-for-activemq-artemis.html">Developing consumer applications for ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connecting-clients-to-a-clustered-artemis-environment.html">Connecting clients to a clustered Artemis environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="demonstrating-message-publishing-and-consumption-patterns.html">Demonstrating message publishing and consumption patterns</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ActiveMQ Artemis Clustering and High Availability</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">ActiveMQ Artemis Clustering and High Availability</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">ActiveMQ Artemis Clustering and High Availability</a></li>
    <li><a href="code-examples.html">Code Examples</a></li>
    <li><a href="developing-consumer-applications-for-activemq-artemis.html">Developing consumer applications for ActiveMQ Artemis</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Developing consumer applications for ActiveMQ Artemis</h1>
<h1 id="_developing_consumer_applications_for_activemq_artemis" class="sect0"><a class="anchor" href="#_developing_consumer_applications_for_activemq_artemis"></a>Developing Consumer Applications for ActiveMQ Artemis</h1>
<div class="paragraph">
<p>In a Message Oriented Middleware (MOM) architecture, consumers are the critical components responsible for processing the messages that producers send to destinations (queues or topics). They are the ultimate recipients of the data, performing the business logic associated with each message. This section will delve into the technical aspects of developing robust and scalable consumer applications for ActiveMQ Artemis, including practical, hands-on activities.</p>
</div>
<div class="sect1">
<h2 id="_understanding_the_role_of_consumers"><a class="anchor" href="#_understanding_the_role_of_consumers"></a>Understanding the Role of Consumers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As introduced in <a href="#./_ROOT/message-oriented-middleware-introduction.adoc" class="xref unresolved">Message Oriented Middleware Introduction</a>, MOM enables loose coupling and asynchronous communication in distributed systems. Consumers are at the heart of this asynchronous processing model.</p>
</div>
<div class="paragraph">
<p>From the producer&#8217;s perspective, the "Fire and Forget" pattern allows it to send a message and immediately return a response to the end-user, without waiting for the message&#8217;s processing to complete. Consumers are the ones who pick up these messages from the queue and perform the actual work.</p>
</div>
<div class="paragraph">
<p>Similarly, during traffic spikes, <a href="#./_ROOT/message-oriented-middleware-introduction.adoc" class="xref unresolved">Traffic Smoothing</a> ensures that the system doesn&#8217;t crash. Messages are buffered in the queue, and consumers process this backlog at a sustainable pace. This means consumers are designed to handle variable message loads, adapting their processing speed as needed.</p>
</div>
<div class="sect2">
<h3 id="_key_characteristics_of_activemq_artemis_consumers"><a class="anchor" href="#_key_characteristics_of_activemq_artemis_consumers"></a>Key Characteristics of ActiveMQ Artemis Consumers</h3>
<div class="paragraph">
<p>ActiveMQ Artemis supports a variety of client protocols, including AMQP, MQTT, STOMP, and OpenWire. This protocol-agnostic approach means that consumers can be developed using client libraries for any of these protocols, connecting seamlessly to an Artemis broker.</p>
</div>
<div class="ulist">
<div class="title">The core responsibilities of an ActiveMQ Artemis consumer include:</div>
<ul>
<li>
<p><strong>Connecting to the Broker:</strong> Establishing a network connection to one or more ActiveMQ Artemis brokers.</p>
</li>
<li>
<p><strong>Subscribing to Destinations:</strong> Specifying which queues or topics they wish to receive messages from.</p>
</li>
<li>
<p><strong>Receiving Messages:</strong> Pulling messages from the subscribed destinations, either synchronously (blocking until a message arrives) or asynchronously (using a message listener).</p>
</li>
<li>
<p><strong>Processing Messages:</strong> Executing the application&#8217;s business logic based on the content of the received message.</p>
</li>
<li>
<p><strong>Acknowledging Messages:</strong> Notifying the broker that a message has been successfully processed, allowing the broker to remove it from the queue. This is crucial for ensuring message reliability and preventing data loss in case of consumer failure.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_scaling_with_competing_consumers"><a class="anchor" href="#_scaling_with_competing_consumers"></a>Scaling with Competing Consumers</h3>
<div class="paragraph">
<p>One of the most powerful features of ActiveMQ Artemis for scaling consumer applications is the concept of <strong>Competing Consumers</strong>. As described in the <a href="#./_ROOT/message-oriented-middleware-introduction.adoc" class="xref unresolved">Introduction to ActiveMQ Artemis</a>, to handle increased load, you can dynamically scale up the number of consumer instances. Artemis automatically load-balances messages across these new consumers, increasing throughput linearly without changing a single line of code in the producer application.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how competing consumers work:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When multiple consumer instances connect to the same queue, ActiveMQ Artemis intelligently distributes messages among them.</p>
</li>
<li>
<p>Each message is delivered to only <strong>one</strong> of the competing consumers.</p>
</li>
<li>
<p>This allows for parallel processing of messages, significantly increasing the overall throughput of your messaging system.</p>
</li>
<li>
<p>If a consumer instance fails, any unacknowledged messages it was processing will eventually be redelivered to another available competing consumer, ensuring high availability and reliability.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This pattern is a cornerstone of resilient and scalable distributed systems, allowing consumer workloads to scale horizontally to meet demand. In a clustered Artemis environment, consumers can connect to any broker in the cluster, and messages will be routed to an available consumer instance, potentially even across different broker nodes, leveraging <a href="#./_ROOT/activemq-artemis-clustering-overview.adoc" class="xref unresolved">Server-Side Load Balancing</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_message_acknowledgement"><a class="anchor" href="#_message_acknowledgement"></a>Message Acknowledgement</h3>
<div class="paragraph">
<p>Message acknowledgement is critical for guaranteed message delivery. When a consumer receives a message, it doesn&#8217;t immediately disappear from the queue. The broker waits for the consumer to acknowledge that it has successfully processed the message.</p>
</div>
<div class="paragraph">
<p>Common acknowledgement modes include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AUTO_ACKNOWLEDGE:</strong> The session automatically acknowledges messages when they are received or after the transaction commits. This is convenient but can lead to message loss if the consumer crashes <strong>after</strong> receiving but <strong>before</strong> fully processing a message.</p>
</li>
<li>
<p><strong>CLIENT_ACKNOWLEDGE:</strong> The client application is responsible for explicitly acknowledging messages using <code>message.acknowledge()</code>. This provides the highest control and reliability. If the consumer crashes before acknowledging, the message will be redelivered.</p>
</li>
<li>
<p><strong>DUPS_OK_ACKNOWLEDGE:</strong> The session acknowledges messages lazily. This can reduce overhead but may result in duplicate message delivery if the consumer fails.</p>
</li>
<li>
<p><strong>SESSION_TRANSACTED:</strong> Messages are part of a transaction. Acknowledgement occurs when the transaction commits, and messages are rolled back to the queue if the transaction fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For enterprise applications requiring high reliability, <code>CLIENT_ACKNOWLEDGE</code> or <code>SESSION_TRANSACTED</code> are generally preferred.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_lab_developing_an_amqp_consumer"><a class="anchor" href="#_hands_on_lab_developing_an_amqp_consumer"></a>Hands-on Lab: Developing an AMQP Consumer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you will develop a simple Java-based consumer application that connects to ActiveMQ Artemis using the AMQP 1.0 protocol. You will subscribe to a queue, receive messages, and acknowledge them. We will then demonstrate the <strong>Competing Consumers</strong> pattern by running multiple instances of our consumer.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>Before you begin, ensure you have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java Development Kit (JDK) 11 or newer:</strong> Installed and configured.</p>
</li>
<li>
<p><strong>Apache Maven:</strong> Installed and configured.</p>
</li>
<li>
<p><strong>An ActiveMQ Artemis Broker:</strong> A running instance of ActiveMQ Artemis. For simplicity, you can run a standalone Artemis broker locally (e.g., download from Apache Artemis site and run <code>bin/artemis run</code>). Ensure it&#8217;s listening on the default AMQP port (5672 or 61616 for OpenShift deployments).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_create_a_maven_project"><a class="anchor" href="#_step_1_create_a_maven_project"></a>Step 1: Create a Maven Project</h3>
<div class="paragraph">
<p>First, create a new Maven project for your consumer application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new directory for your project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir artemis-consumer-app
cd artemis-consumer-app</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>pom.xml</code> file with the necessary dependencies:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.example.artemis&lt;/groupId&gt;
    &lt;artifactId&gt;artemis-consumer-app&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;qpid-jms.version&gt;2.2.0&lt;/qpid-jms.version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;slf4j.version&gt;2.0.7&lt;/slf4j.version&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!-- Qpid JMS Client for AMQP 1.0 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.qpid&lt;/groupId&gt;
            &lt;artifactId&gt;qpid-jms-client&lt;/artifactId&gt;
            &lt;version&gt;${qpid-jms.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Logging --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
            &lt;version&gt;${slf4j.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
            &lt;version&gt;${slf4j.version}&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;${maven.compiler.source}&lt;/source&gt;
                    &lt;target&gt;${maven.compiler.target}&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.1.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.example.artemis.Consumer&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Qpid JMS client is a robust implementation for AMQP 1.0.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>SLF4J is used for logging, with <code>slf4j-simple</code> providing a basic console logger.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_write_the_consumer_application"><a class="anchor" href="#_step_2_write_the_consumer_application"></a>Step 2: Write the Consumer Application</h3>
<div class="paragraph">
<p>Create the Java source file <code>src/main/java/com/example/artemis/Consumer.java</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the directory structure:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p src/main/java/com/example/artemis</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Consumer.java</code> file with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.artemis;

import org.apache.qpid.jms.JmsConnectionFactory;
import javax.jms.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Consumer {

    private static final Logger LOG = LoggerFactory.getLogger(Consumer.class);
    private static final String BROKER_URL = "amqp://localhost:5672"; <i class="conum" data-value="1"></i><b>(1)</b>
    private static final String QUEUE_NAME = "example.queue"; <i class="conum" data-value="2"></i><b>(2)</b>

    public static void main(String[] args) throws Exception {
        Connection connection = null;
        Session session = null;
        MessageConsumer consumer = null;

        try {
            LOG.info("Connecting to broker: {}", BROKER_URL);
            JmsConnectionFactory factory = new JmsConnectionFactory(BROKER_URL);
            connection = factory.createConnection(); <i class="conum" data-value="3"></i><b>(3)</b>
            connection.start(); <i class="conum" data-value="4"></i><b>(4)</b>

            session = connection.createSession(false, Session.CLIENT_ACKNOWLEDGE); <i class="conum" data-value="5"></i><b>(5)</b>
            Destination destination = session.createQueue(QUEUE_NAME); <i class="conum" data-value="6"></i><b>(6)</b>
            consumer = session.createConsumer(destination); <i class="conum" data-value="7"></i><b>(7)</b>

            LOG.info("Waiting for messages on queue: {}", QUEUE_NAME);

            // Using an asynchronous message listener
            consumer.setMessageListener(message -&gt; { <i class="conum" data-value="8"></i><b>(8)</b>
                try {
                    if (message instanceof TextMessage) {
                        TextMessage textMessage = (TextMessage) message;
                        LOG.info("Received message: '{}' from Consumer on Thread: {}", textMessage.getText(), Thread.currentThread().getName());
                    } else {
                        LOG.info("Received non-text message: {}", message.getClass().getName());
                    }
                    message.acknowledge(); <i class="conum" data-value="9"></i><b>(9)</b>
                    LOG.info("Message acknowledged.");
                } catch (JMSException e) {
                    LOG.error("Error processing message: {}", e.getMessage(), e);
                }
            });

            // Keep the main thread alive to allow message listener to operate
            Thread.currentThread().join(); <i class="conum" data-value="10"></i><b>(10)</b>

        } catch (JMSException e) {
            LOG.error("JMS Exception occurred: {}", e.getMessage(), e);
        } finally {
            // Clean up resources if an error occurs before the join()
            if (consumer != null) {
                try {
                    consumer.close();
                } catch (JMSException e) {
                    LOG.error("Error closing consumer: {}", e.getMessage(), e);
                }
            }
            if (session != null) {
                try {
                    session.close();
                } catch (JMSException e) {
                    LOG.error("Error closing session: {}", e.getMessage(), e);
                }
            }
            if (connection != null) {
                try {
                    connection.close();
                } catch (JMSException e) {
                    LOG.error("Error closing connection: {}", e.getMessage(), e);
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Connection URI for your Artemis broker. If using a local standalone broker, <code>localhost:5672</code> is common. For OpenShift, this would be the AMQP service route.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the queue to consume messages from. Make sure this queue exists on your Artemis broker. If it doesn&#8217;t, Artemis will typically auto-create it on first use.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates a connection to the broker.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Starts the connection. Messages will not be delivered until the connection is started.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Creates a session. <code>false</code> indicates not transacted. <code>Session.CLIENT_ACKNOWLEDGE</code> means the consumer must explicitly acknowledge messages.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Defines the destination (queue) we want to consume from.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Creates a message consumer linked to our destination.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Sets an asynchronous <code>MessageListener</code>. This is a non-blocking way to receive messages. The <code>onMessage</code> method will be invoked whenever a new message arrives.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td><strong>Crucial step!</strong> Explicitly acknowledges the message. Without this, the message would remain on the queue and eventually be redelivered.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Keeps the main thread alive indefinitely so the <code>MessageListener</code> can continue to receive messages. In a real application, you might use a more sophisticated lifecycle management.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_compile_and_run_the_consumer"><a class="anchor" href="#_step_3_compile_and_run_the_consumer"></a>Step 3: Compile and Run the Consumer</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Compile your application using Maven:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install</code></pre>
</div>
</div>
</li>
<li>
<p>Run the consumer application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn exec:java</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to this, indicating the consumer is connected and waiting for messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[INFO] Connecting to broker: amqp://localhost:5672
[INFO] Waiting for messages on queue: example.queue</code></pre>
</div>
</div>
</li>
<li>
<p>If you have a producer application (as covered in <a href="#./_ROOT/developing-producer-applications.adoc" class="xref unresolved">Developing Producer Applications</a>) running and sending messages to <code>example.queue</code>, your consumer will start receiving and logging them:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[INFO] Received message: 'Hello from Producer - 1' from Consumer on Thread: ActiveMQJMSClient-Thread-1
[INFO] Message acknowledged.
[INFO] Received message: 'Hello from Producer - 2' from Consumer on Thread: ActiveMQJMSClient-Thread-2
[INFO] Message acknowledged.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_demonstrate_competing_consumers"><a class="anchor" href="#_step_4_demonstrate_competing_consumers"></a>Step 4: Demonstrate Competing Consumers</h3>
<div class="paragraph">
<p>To observe the <strong>Competing Consumers</strong> pattern:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Keep your first consumer instance running.</p>
</li>
<li>
<p>Open a <strong>new terminal window</strong> in the <code>artemis-consumer-app</code> directory.</p>
</li>
<li>
<p>Run another instance of the consumer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn exec:java</code></pre>
</div>
</div>
</li>
<li>
<p>Now, if you send messages from your producer to <code>example.queue</code>, you will notice that the messages are distributed between the two running consumer instances. Each message will be processed by only one consumer.</p>
<div class="paragraph">
<p>You will see messages appearing alternately in the logs of your two consumer terminals, demonstrating that ActiveMQ Artemis is load-balancing messages across the available consumers. This behavior highlights how easily you can scale your message processing capabilities by simply deploying more consumer instances.</p>
</div>
</li>
<li>
<p>To stop the consumers, press <code>Ctrl+C</code> in each terminal window.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hands-on activity provides a foundational understanding of how to build reliable and scalable consumer applications for ActiveMQ Artemis, leveraging its core features like protocol agnosticism and competing consumers.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="developing-producer-applications-for-activemq-artemis.html">Developing producer applications for ActiveMQ Artemis</a></span>
  <span class="next"><a href="connecting-clients-to-a-clustered-artemis-environment.html">Connecting clients to a clustered Artemis environment</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
